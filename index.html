<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù - SHIB Ads API</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7fa;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: right;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            text-align: right;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: inline-block;
            margin-top: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }
        .status-success {
            background-color: #e8f5e9;
            color: #27ae60;
        }
        .status-error {
            background-color: #fce4ec;
            color: #c0392b;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: #fff;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }
        th {
            background-color: #ecf0f1;
            color: #333;
        }
        .action-cell {
            white-space: nowrap;
        }
    </style>
</head>
<body>

<div class="container" id="login-container">
    <h1>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h1>
    <p>Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙˆØ­Ø© ØªØ¹Ù…Ù„ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¥Ù„Ù‰ Ù…Ù„Ù <span style="color: #c0392b;">index.js</span> Ø§Ù„Ø¢Ù…Ù† (API Endpoint).</p>
    <label for="adminIdInput">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±Ù (Admin User ID):</label>
    <input type="number" id="adminIdInput" value="7741750541" readonly>
    <label for="apiEndpointInput">Ø¹Ù†ÙˆØ§Ù† API (Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© index.js Ø¹Ù„Ù‰ Vercel):</label>
    <input type="text" id="apiEndpointInput" placeholder="https://your-project.vercel.app/api">
    <button onclick="loginAdmin()">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    <div id="loginStatus" class="status-message"></div>
</div>

<div class="container" id="admin-panel" style="display: none;">
    <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù ğŸš€</h1>
    <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ Ø§Ù„Ù…Ø´Ø±Ù **<span id="adminName"></span>** (ID: 7741750541)</p>
    
    <hr>

    <div class="section">
        <h2>Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ğŸ’°</h2>
        <button onclick="fetchPendingWithdrawals()">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</button>
        <div id="withdrawalStatus" class="status-message"></div>
        <div id="pendingWithdrawalsList">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>User ID</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Binance ID/Wallet</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                        <th class="action-cell">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="withdrawalsBody">
                    <tr><td colspan="6">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† API Ø£ÙˆÙ„Ø§Ù‹.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <hr>

    <div class="section">
        <h2>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ğŸ”</h2>
        <label for="searchUserId">Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… (User ID):</label>
        <input type="number" id="searchUserId" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <button onclick="searchUser()">Ø¨Ø­Ø«</button>

        <div id="userProfile" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px; display: none;">
            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <span id="currentUserId"></span></h3>
            <p>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: **<span id="currentBalance"></span> SHIB**</p>
            <p>Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø±: **<span id="currentBanStatus"></span>**</p>

            <label for="newBalance">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø¥Ù„Ù‰:</label>
            <input type="number" id="newBalance" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
            <button onclick="updateUserBalance()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯</button>

            <div style="margin-top: 10px;">
                <label for="banStatusSelect">ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø±:</label>
                <select id="banStatusSelect">
                    <option value="false">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±</option>
                    <option value="true">Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</option>
                </select>
                <button onclick="updateUserBanStatus()">ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø±</button>
            </div>
            <div id="userUpdateStatus" class="status-message"></div>
        </div>
    </div>
</div>

<script>
    // âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø¹ Ù‚ÙŠÙ…Ø© ADMIN_USER_ID ÙÙŠ Ù…Ù„Ù index.js
    const ADMIN_USER_ID = 7741750541; 
    let API_ENDPOINT = ''; // Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ Ù…Ù† Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„

    let currentSearchedUser = null;

    /**
     * Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ POST Ø¢Ù…Ù† Ø¥Ù„Ù‰ API (index.js)
     */
    async function sendAdminRequest(action, target_id = null, new_value = null, withdrawal_id = null, amount = null) {
        if (!API_ENDPOINT) {
            alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† API Ø£ÙˆÙ„Ø§Ù‹.');
            return { ok: false, error: 'API endpoint not set.' };
        }

        const payload = {
            type: 'adminAction',
            user_id: ADMIN_USER_ID, // âš ï¸ Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† Ø£Ù† index.js ÙŠØ±ÙØ¶ Ø£ÙŠ Ø·Ù„Ø¨ Ù…Ù† Ù…ØµØ¯Ø± Ø¢Ø®Ø±
            action,
            target_id,
            new_value,
            withdrawal_id,
            amount
        };

        try {
            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });

            const data = await response.json();
            
            if (!data.ok) {
                console.error('API Error:', data.error);
                return { ok: false, error: data.error || 'Unknown API Error' };
            }
            return { ok: true, data: data.data };

        } catch (error) {
            console.error('Network or communication error:', error.message);
            return { ok: false, error: 'Network Error: ' + error.message };
        }
    }

    /**
     * Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
     */
    function loginAdmin() {
        const adminId = parseInt(document.getElementById('adminIdInput').value);
        const apiEndpoint = document.getElementById('apiEndpointInput').value.trim();
        const loginStatus = document.getElementById('loginStatus');
        
        if (adminId === ADMIN_USER_ID && apiEndpoint.length > 10) {
            API_ENDPOINT = apiEndpoint;
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('adminName').textContent = 'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ';
            loginStatus.style.display = 'none';
            fetchPendingWithdrawals(); // Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        } else {
            loginStatus.textContent = 'Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±Ù ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ø¹Ù†ÙˆØ§Ù† API Ù…ÙÙ‚ÙˆØ¯.';
            loginStatus.className = 'status-message status-error';
            loginStatus.style.display = 'block';
        }
    }

    /**
     * Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„Ø©
     */
    function showStatus(elementId, message, isSuccess) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = 'status-message ' + (isSuccess ? 'status-success' : 'status-error');
        element.style.display = 'block';
        setTimeout(() => element.style.display = 'none', 5000);
    }

    /**
     * Ø¬Ù„Ø¨ Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
     */
    async function fetchPendingWithdrawals() {
        const result = await sendAdminRequest('fetchPendingWithdrawals');
        const tbody = document.getElementById('withdrawalsBody');
        tbody.innerHTML = ''; 

        if (!result.ok) {
             tbody.innerHTML = `<tr><td colspan="6" style="color: red;">ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª: ${result.error}</td></tr>`;
             return showStatus('withdrawalStatus', 'ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª.', false);
        }

        const data = result.data.withdrawals || [];

        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</td></tr>';
        } else {
            data.forEach(item => {
                const row = tbody.insertRow();
                row.insertCell().textContent = item.id;
                row.insertCell().textContent = item.user_id;
                row.insertCell().textContent = item.amount;
                row.insertCell().textContent = item.binance_id || 'N/A';
                row.insertCell().textContent = new Date(item.created_at).toLocaleString();
                
                const actionCell = row.insertCell();
                actionCell.className = 'action-cell';
                
                // Ø²Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                const approveBtn = document.createElement('button');
                approveBtn.textContent = 'ØªÙ†ÙÙŠØ° (Ù…ÙƒØªÙ…Ù„)';
                approveBtn.style.backgroundColor = '#2ecc71';
                approveBtn.style.marginLeft = '10px';
                approveBtn.onclick = () => updateWithdrawalStatus(item.id, item.user_id, 'completed', item.amount);
                actionCell.appendChild(approveBtn);

                // Ø²Ø± Ø§Ù„Ø±ÙØ¶
                const rejectBtn = document.createElement('button');
                rejectBtn.textContent = 'Ø±ÙØ¶ (Ù…Ù„ØºÙ‰)';
                rejectBtn.style.backgroundColor = '#e74c3c';
                rejectBtn.onclick = () => updateWithdrawalStatus(item.id, item.user_id, 'cancelled', item.amount);
                actionCell.appendChild(rejectBtn);
            });
        }
        showStatus('withdrawalStatus', `ØªÙ… Ø¬Ù„Ø¨ ${data.length} Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ù…Ø¹Ù„Ù‚.`, true);
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨ (Ù…ÙƒØªÙ…Ù„/Ù…Ù„ØºÙ‰)
     */
    async function updateWithdrawalStatus(withdrawalId, userId, newStatus, amount) {
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨ #${withdrawalId} Ù„Ù€ ${userId} Ø¥Ù„Ù‰ '${newStatus}'ØŸ`)) {
            return;
        }

        const result = await sendAdminRequest(
            'processWithdrawal', 
            userId, 
            newStatus, 
            withdrawalId, 
            amount
        );

        if (result.ok) {
            showStatus('withdrawalStatus', result.data.message, true);
            fetchPendingWithdrawals(); 
        } else {
            showStatus('withdrawalStatus', 'ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨: ' + result.error, false);
        }
    }

    /**
     * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙˆØ§Ø³Ø·Ø© ID
     */
    async function searchUser() {
        const userId = parseInt(document.getElementById('searchUserId').value);
        if (!userId) return showStatus('userUpdateStatus', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ User ID.', false);
        
        const result = await sendAdminRequest('fetchUser', userId);

        if (!result.ok) {
            document.getElementById('userProfile').style.display = 'none';
            return showStatus('userUpdateStatus', result.error, false);
        }

        const data = result.data.user;
        currentSearchedUser = data;
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('currentUserId').textContent = data.id;
        document.getElementById('currentBalance').textContent = data.balance;
        document.getElementById('currentBanStatus').textContent = data.is_banned ? 'Ù…Ø­Ø¸ÙˆØ± (BANNED)' : 'Ù†Ø´Ø·';
        document.getElementById('newBalance').value = data.balance;
        document.getElementById('banStatusSelect').value = data.is_banned.toString();
        document.getElementById('userProfile').style.display = 'block';

        showStatus('userUpdateStatus', `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}.`, true);
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
     */
    async function updateUserBalance() {
        if (!currentSearchedUser) return showStatus('userUpdateStatus', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹.', false);
        
        const newBalance = parseFloat(document.getElementById('newBalance').value);
        if (isNaN(newBalance) || newBalance < 0) return showStatus('userUpdateStatus', 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ØµØ§Ù„Ø­Ø©.', false);

        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${currentSearchedUser.id} Ø¥Ù„Ù‰ ${newBalance} SHIBØŸ`)) {
            return;
        }

        const result = await sendAdminRequest('updateBalance', currentSearchedUser.id, newBalance);

        if (result.ok) {
            currentSearchedUser.balance = newBalance;
            document.getElementById('currentBalance').textContent = newBalance;
            showStatus('userUpdateStatus', result.data.message, true);
        } else {
            showStatus('userUpdateStatus', 'ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯: ' + result.error, false);
        }
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
     */
    async function updateUserBanStatus() {
        if (!currentSearchedUser) return showStatus('userUpdateStatus', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹.', false);
        
        const isBanned = document.getElementById('banStatusSelect').value;
        const actionText = isBanned === 'true' ? 'Ø­Ø¸Ø±' : 'Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø±';
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${actionText} Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${currentSearchedUser.id}ØŸ`)) {
            return;
        }

        const result = await sendAdminRequest('updateBanStatus', currentSearchedUser.id, isBanned);

        if (result.ok) {
            currentSearchedUser.is_banned = isBanned === 'true';
            document.getElementById('currentBanStatus').textContent = currentSearchedUser.is_banned ? 'Ù…Ø­Ø¸ÙˆØ± (BANNED)' : 'Ù†Ø´Ø·';
            document.getElementById('banStatusSelect').value = isBanned;
            showStatus('userUpdateStatus', result.data.message, true);
        } else {
            showStatus('userUpdateStatus', 'ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø±: ' + result.error, false);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('adminIdInput').value = ADMIN_USER_ID;
        // ÙŠÙ…ÙƒÙ†Ùƒ ÙˆØ¶Ø¹ Ø§Ù„Ù€ API Endpoint Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù‡Ù†Ø§ Ø¨Ù…Ø¬Ø±Ø¯ Ù†Ø´Ø±Ù‡ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø§Ù„Ù…ØªÙƒØ±Ø±
        // document.getElementById('apiEndpointInput').value = 'https://your-project.vercel.app/api'; 
    });

</script>
</body>
</html>